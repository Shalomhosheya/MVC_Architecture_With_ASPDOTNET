@{
ViewData["Title"] = "Register User";
}
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

</head>
<style>
    .table-active {
        background-color: #007bff !important;
        color: white;
        cursor: pointer;
    }
    tr:hover {
        background-color: #e0e0e0;
        cursor: pointer;
    }
</style>

<div style="max-width: 400px; margin: 50px auto; padding: 20px; border: 1px solid #ccc; border-radius: 8px;">
    <h2>Register User</h2>

    <div id="message" style="display:none; padding: 10px; margin-bottom: 15px; border-radius: 4px;"></div>

    <div style="margin-bottom: 15px;">
        <label>ID:</label><br>
        <input type="email" id="exampleInputID" placeholder="Enter ID" style="width: 100%; padding: 8px;">
    </div>
    <div style="margin-bottom: 15px;">
        <label>Email:</label><br>
        <input type="email" id="exampleInputEmail1" placeholder="Enter email" style="width: 100%; padding: 8px;">
    </div>

    <div style="margin-bottom: 15px;">
        <label>Password:</label><br>
        <input type="password" id="exampleInputPassword1" placeholder="Enter password" style="width: 100%; padding: 8px;">
    </div>
    <div style="display: flex; flex-direction: column; gap: 10px; width: 100%;">

        <button id="submitBtn"
                style="padding: 10px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
            Submit
        </button>

        <button id="deleteBtn"
                style="padding: 10px; background-color: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">
            Delete
        </button>

        <button id="updateBtn"
                style="padding: 10px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">
            Update
        </button>
        <button id="resetBtn"
                style="padding: 10px; background-color: gold; color: white; border: none; border-radius: 4px; cursor: pointer;">
            Reset
        </button>

    </div>

</div>
<div class="card ">
    <table class="table table-striped-columns table-dark ">
        <thead>
        <tr>
            <th scope="col">ID</th>
            <th scope="col">Email</th>
            <th scope="col">Password</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <th scope="row"></th>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <th scope="row"></th>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <th scope="row"></th>
            <td></td>
            <td></td>
        </tr>
        </tbody>
    </table>
</div>
<script>
    console.log("Register page loaded successfully!");

    const id = document.getElementById("exampleInputID");
    const email = document.getElementById("exampleInputEmail1");
    const password = document.getElementById("exampleInputPassword1");
    const button = document.getElementById("submitBtn");
    const delbutton = document.getElementById("deleteBtn");
    const updatebutton = document.getElementById("updateBtn");
    const resetBtn = document.getElementById("resetBtn");
    const messageDiv = document.getElementById("message");
    resetBtn.addEventListener("click", (e) => {
        e.preventDefault();
            id.value = " ", 
            email.value = " ", 
                password.value = " "
    })
    button.addEventListener("click", async function (event) {
        event.preventDefault();
        loadUsers()
        // Simple validation
        if (!email.value || !password.value) {
            showMessage("Please fill in all fields", "error");
            return;
        }

        const data = {
            email: email.value,
            password: password.value,
            
        };

        try {
            const response = await fetch('/User/SaveUser', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                const result = await response.json();
                console.log(result.message);
                showMessage(result.message, "success");

                // Clear form
                email.value = "";
                password.value = "";
            } else {
                showMessage("Error saving user", "error");
            }
        } catch (error) {
            console.error("Error:", error);
            showMessage("Network error occurred", "error");
        }
    });
    delbutton.addEventListener("click", async function (event) {
        event.preventDefault();
        loadUsers()
        if (!id.value) {
            showMessage("Please enter the user ID to delete", "error");
            return;
        }

        const data = { id: parseInt(id.value) };

        try {
            const response = await fetch('/User/DeleteUser', {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                const result = await response.json();
                console.log(result.message);
                showMessage(result.message, "success");

                id.value = "";
                email.value = "";
                password.value = "";
            } else {
                showMessage("Error deleting user", "error");
            }
        } catch (error) {
            console.error("Error:", error);
            showMessage("Network error occurred", "error");
        }
    });

    updatebutton.addEventListener("click", async function (event) {
        event.preventDefault();
        loadUsers()
        if (!id.value) {
            showMessage("Please enter the user ID to update", "error");
        }
        const data = {
            id:parseInt(id.value),
            email : email.value,
            password:password.value
        }
        try {
            const response = await fetch('/User/EditUser', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                'body': JSON.stringify(data)
            })
            if (response.ok) {
                const result = await response.json();
                console.log(result.message);
                showMessage(result.message, "success");
                
            }
        }catch(error) {
            console.error("Error:", error);
        }
         
    });
    // Load users when page loads
    window.addEventListener("DOMContentLoaded", loadUsers);

    async function loadUsers() {
        try {
            const response = await fetch('/User/GetAllUsers');
            if (response.ok) {
                const users = await response.json();

                const tableBody = document.querySelector("table tbody");
                tableBody.innerHTML = ""; // Clear old data

                users.forEach(user => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                    <th scope="row">${user.id}</th>
                    <td>${user.email}</td>
                    <td>${user.password}</td>
                `;

                    // ✅ Add click event for each row
                    row.addEventListener("click", function () {
                        id.value = user.id;
                        email.value = user.email;
                        password.value = user.password;

                        // Highlight selected row
                        document.querySelectorAll("table tbody tr").forEach(r => r.classList.remove("table-active"));
                        row.classList.add("table-active");
                    });

                    tableBody.appendChild(row);
                });
            } else {
                console.error("Failed to load users");
            }
        } catch (error) {
            console.error("Error loading users:", error);
        }
    }


    function showMessage(text, type) {
        messageDiv.textContent = text;
        messageDiv.style.display = "block";
        messageDiv.style.backgroundColor = type === "success" ? "#d4edda" : "#f8d7da";
        messageDiv.style.color = type === "success" ? "#155724" : "#721c24";
        messageDiv.style.border = type === "success" ? "1px solid #c3e6cb" : "1px solid #f5c6cb";
    }
</script>